 ss: answers.t1_ss || '',<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FCE Writing Week 1 - Trung T√¢m Ti·∫øng Anh LIME</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 50%, #81C784 100%);
        }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4CAF50;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .paste-warning {
            animation: shake 0.5s;
            border-color: #f44336 !important;
            background-color: #ffebee !important;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        textarea:focus, input:focus {
            outline: none;
            border-color: #4CAF50 !important;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }
        .topic-prompt {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        .topic-prompt.expanded {
            max-height: 500px;
        }
    </style>
</head>
<body>

<!-- M√†n h√¨nh nh·∫≠p m√£ -->
<div id="codeScreen" class="min-h-screen p-4 fade-in">
    <div class="max-w-2xl mx-auto">
        <div class="bg-white rounded-2xl shadow-2xl p-8 mt-8">
            <div class="text-center mb-8">
                <img src="https://gofirst.pro/images/uploads/62/baseimg/logo_16541442053.png" 
                     alt="LIME Logo" class="w-32 h-32 mx-auto mb-4 object-contain">
                <h1 class="text-4xl font-bold text-green-700 mb-2">Trung T√¢m Ti·∫øng Anh LIME</h1>
                <p class="text-green-600 text-lg">üìû Hotline: 0976222792</p>
                <div class="mt-4 h-1 w-32 bg-green-500 mx-auto rounded"></div>
            </div>
            
            <div class="bg-green-50 rounded-xl p-6 mb-6">
                <h2 class="text-2xl font-bold text-green-800 mb-4">FCE WRITING - WEEK 1</h2>
                <div class="space-y-2 text-green-700">
                     <p>üìå Topic 1: Appearance & Society</p>
    <p>üìå Topic 2: Students & School Decisions</p>
    <p>üìå Topic 3: Technology & Happiness</p>
    <p>üìå Topic 4: Opportunities for Young People</p>
    <p>üìå Topic 5: Practical Life Skills in Schools</p>
 <hr class="my-2 border-green-300">
                    <p>üìù Ph√¢n t√≠ch ƒë·ªÅ (SS, IS, Q, T + Outline)</p>
                    <p>üìÑ Vi·∫øt m·ªü b√†i (50-70 words)</p>
                    <p>üìä H·ªá th·ªëng theo d√µi h√†nh vi l√†m b√†i</p>
                </div>
            </div>

            <div class="bg-yellow-50 border-2 border-yellow-300 rounded-xl p-4 mb-6">
                <div class="flex items-start gap-2">
                    <svg class="w-6 h-6 text-yellow-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                    </svg>
                    <div class="text-yellow-800">
                        <p class="font-bold mb-1">‚ö†Ô∏è L∆∞u √Ω:</p>
                        <p>‚Ä¢ H·ªá th·ªëng s·∫Ω ghi nh·∫≠n s·ªë l·∫ßn paste v√† ch·ªânh s·ª≠a</p>
                        <p>‚Ä¢ Kh√¥ng n√™n copy t·ª´ ngu·ªìn kh√°c</p>
                        <p>‚Ä¢ L√†m b√†i trung th·ª±c ƒë·ªÉ c√≥ k·∫øt qu·∫£ t·ªët nh·∫•t</p>
                    </div>
                </div>
            </div>

            <div>
                <label class="block text-green-800 font-semibold mb-2">M√£ h·ªçc sinh *</label>
                <input type="text" id="studentCode" 
                    class="w-full px-4 py-3 border-2 border-green-300 rounded-lg uppercase text-lg"
                    placeholder="Nh·∫≠p m√£ h·ªçc sinh (VD: HS001)">
            </div>

            <button onclick="verifyStudent()" 
                class="w-full mt-6 bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-lg transition duration-300 text-lg shadow-lg">
                X√ÅC NH·∫¨N & B·∫ÆT ƒê·∫¶U
            </button>
        </div>
    </div>
</div>

<!-- M√†n h√¨nh l√†m b√†i -->
<div id="testScreen" class="hidden min-h-screen p-4 pb-32">
    <div class="max-w-5xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-2xl shadow-2xl p-6 mb-6 sticky top-4 z-10">
            <div class="flex justify-between items-center flex-wrap gap-4">
                <div class="flex items-center gap-3">
                    <img src="https://gofirst.pro/images/uploads/62/baseimg/logo_16541442053.png" 
                         alt="LIME Logo" class="w-12 h-12 object-contain">
                    <div>
                        <h1 class="text-2xl font-bold text-green-700">FCE Writing - Week 1</h1>
                        <p class="text-green-600 text-sm">Essay Analysis & Introduction</p>
                    </div>
                </div>
                
                <div class="text-right">
                    <p class="text-sm text-gray-600">H·ªçc sinh: <span id="headerName" class="font-semibold"></span></p>
                    <p class="text-sm text-gray-600">M√£: <span id="headerCode" class="font-semibold"></span></p>
                    <p class="text-sm text-gray-600">‚è±Ô∏è Th·ªùi gian: <span id="timerDisplay">00:00</span></p>
                </div>
            </div>
            
            <div class="mt-4">
                <div class="flex justify-between text-sm text-gray-600 mb-1">
                    <span>Ti·∫øn ƒë·ªô: <span id="progressCount">0</span>/40 m·ª•c</span>
                    <span id="progressPercent">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div id="progressBar" class="bg-green-600 h-3 rounded-full transition-all" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- TOPIC 1 -->
        <div class="bg-white rounded-2xl shadow-2xl p-8 mb-6 fade-in">
            <div class="bg-gradient-to-r from-blue-600 to-blue-500 text-white px-6 py-4 rounded-t-xl -mx-8 -mt-8 mb-6">
                <h2 class="text-2xl font-bold">üìù ƒê·ªÄ 1: APPEARANCE & SOCIETY</h2>
                <p class="text-sm opacity-90">We are much too worried about how people and things look</p>
            </div>

            <!-- ƒê·ªÅ b√†i ƒë·∫ßy ƒë·ªß -->
            <div class="bg-blue-50 border-l-4 border-blue-600 p-5 mb-6 rounded-r-lg">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <h3 class="font-bold text-blue-800 mb-3 text-lg">üìã Essay Topic:</h3>
                        <p class="text-blue-900 mb-3 text-lg font-semibold">"We are much too worried about how people and things look. Do you agree?"</p>
                        <p class="text-blue-700 text-sm"><em>Points to consider: being like your friends / the effect of celebrities / your own idea</em></p>
                    </div>
                    <button onclick="togglePrompt('topic1')" class="ml-4 text-blue-600 hover:text-blue-800 font-semibold text-sm whitespace-nowrap">
                        [Xem th√™m ‚ñº]
                    </button>
                </div>
                
                <div id="topic1Prompt" class="topic-prompt mt-4 pt-4 border-t border-blue-200">
                    <p class="text-blue-800 text-sm leading-relaxed">
                        Many people believe that in modern society, we place too much emphasis on appearance - how people look, what they wear, and how things appear on the surface. Some argue this focus on looks comes from wanting to fit in with friends, the influence of celebrities and social media, and societal pressure to maintain certain standards. Do you agree that we are too concerned with appearances?
                    </p>
                </div>
            </div>

            <!-- Ph√¢n t√≠ch ƒë·ªÅ -->
            <div class="bg-gray-50 rounded-xl p-6 mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b-2 border-green-500 pb-2">PH·∫¶N 1: PH√ÇN T√çCH ƒê·ªÄ B√ÄI</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">1. SS (Specific Subject): *</label>
                        <input type="text" id="t1_ss" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg"
                            placeholder="Are there any specific subjects?"
                            data-field="t1_ss">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">2. IS (Independent Subject): *</label>
                        <input type="text" id="t1_is" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg"
                            placeholder="Are there any independent subjects?"
                            data-field="t1_is">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">3. Q (Question): *</label>
                        <input type="text" id="t1_q" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg"
                            placeholder="What are the questions?"
                            data-field="t1_q">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">4. T (Tasks): *</label>
                        <input type="text" id="t1_t" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg"
                            placeholder="How many tasks must we address?"
                            data-field="t1_t">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Body 1: *</label>
                            <input type="text" id="t1_body1" 
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                placeholder="Idea 1"
                                data-field="t1_body1">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Body 2: *</label>
                            <input type="text" id="t1_body2" 
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                placeholder="Idea 2"
                                data-field="t1_body2">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Body 3: *</label>
                            <input type="text" id="t1_body3" 
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                placeholder="Your own idea"
                                data-field="t1_body3">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Vi·∫øt m·ªü b√†i -->
            <div class="bg-gray-50 rounded-xl p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b-2 border-green-500 pb-2">PH·∫¶N 2: VI·∫æT M·ªû B√ÄI</h3>
                
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Introduction Paragraph: *</label>
                    <textarea id="t1_intro" rows="8"
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg resize-vertical"
                        placeholder="Write your introduction here... (50-70 words recommended)"
                        data-field="t1_intro"></textarea>
                    <div class="flex justify-between items-center mt-2">
                        <div class="text-sm text-gray-600">
                            <span>‚úèÔ∏è Ch·ªânh s·ª≠a: <span id="t1_intro_edits" class="font-semibold">0</span> l·∫ßn</span>
                            <span class="mx-2">|</span>
                            <span id="t1_intro_paste_warning" class="text-red-600 font-semibold hidden">‚ö†Ô∏è Paste: <span id="t1_intro_pastes">0</span> l·∫ßn</span>
                        </div>
                        <div id="t1_intro_count" class="text-lg font-semibold text-gray-700">Words: 0 / 50-70</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TOPIC 2 -->
        <div class="bg-white rounded-2xl shadow-2xl p-8 mb-6 fade-in">
            <div class="bg-gradient-to-r from-purple-600 to-purple-500 text-white px-6 py-4 rounded-t-xl -mx-8 -mt-8 mb-6">
                <h2 class="text-2xl font-bold">üìù ƒê·ªÄ 2: STUDENTS & SCHOOL DECISIONS</h2>
                <p class="text-sm opacity-90">Students should help to make decisions about what happens at school</p>
            </div>

            <!-- ƒê·ªÅ b√†i ƒë·∫ßy ƒë·ªß -->
            <div class="bg-purple-50 border-l-4 border-purple-600 p-5 mb-6 rounded-r-lg">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <h3 class="font-bold text-purple-800 mb-3 text-lg">üìã Essay Topic:</h3>
                        <p class="text-purple-900 mb-3 text-lg font-semibold">"Do you think that students should help to make decisions about what happens at school?"</p>
                        <p class="text-purple-700 text-sm"><em>Points to consider: the subjects children study / school rules / your own idea</em></p>
                    </div>
                    <button onclick="togglePrompt('topic2')" class="ml-4 text-purple-600 hover:text-purple-800 font-semibold text-sm whitespace-nowrap">
                        [Xem th√™m ‚ñº]
                    </button>
                </div>
                
                <div id="topic2Prompt" class="topic-prompt mt-4 pt-4 border-t border-purple-200">
                    <p class="text-purple-800 text-sm leading-relaxed">
                        There is ongoing debate about whether students should have a voice in school decisions. Some believe students should participate in choosing subjects they study, creating school rules, and other aspects of school life. Others think these decisions should remain with teachers and administrators. What is your opinion on student involvement in school decision-making?
                    </p>
                </div>
            </div>

            <!-- Ph√¢n t√≠ch ƒë·ªÅ -->
            <div class="bg-gray-50 rounded-xl p-6 mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b-2 border-green-500 pb-2">PH·∫¶N 1: PH√ÇN T√çCH ƒê·ªÄ B√ÄI</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">1. SS (Specific Subject): *</label>
                        <input type="text" id="t2_ss" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg"
                            placeholder="Are there any specific subjects?"
                            data-field="t2_ss">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">2. IS (Independent Subject): *</label>
                        <input type="text" id="t2_is" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg"
                            placeholder="Are there any independent subjects?"
                            data-field="t2_is">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">3. Q (Question): *</label>
                        <input type="text" id="t2_q" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg"
                            placeholder="What are the questions?"
                            data-field="t2_q">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">4. T (Tasks): *</label>
                        <input type="text" id="t2_t" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg"
                            placeholder="How many tasks must we address?"
                            data-field="t2_t">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Body 1: *</label>
                            <input type="text" id="t2_body1" 
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                placeholder="Idea 1"
                                data-field="t2_body1">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Body 2: *</label>
                            <input type="text" id="t2_body2" 
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                placeholder="Idea 2"
                                data-field="t2_body2">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Body 3: *</label>
                            <input type="text" id="t2_body3" 
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                placeholder="Your own idea"
                                data-field="t2_body3">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Vi·∫øt m·ªü b√†i -->
            <div class="bg-gray-50 rounded-xl p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b-2 border-green-500 pb-2">PH·∫¶N 2: VI·∫æT M·ªû B√ÄI</h3>
                
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Introduction Paragraph: *</label>
                    <textarea id="t2_intro" rows="8"
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg resize-vertical"
                        placeholder="Write your introduction here... (50-70 words recommended)"
                        data-field="t2_intro"></textarea>
                    <div class="flex justify-between items-center mt-2">
                        <div class="text-sm text-gray-600">
                            <span>‚úèÔ∏è Ch·ªânh s·ª≠a: <span id="t2_intro_edits" class="font-semibold">0</span> l·∫ßn</span>
                            <span class="mx-2">|</span>
                            <span id="t2_intro_paste_warning" class="text-red-600 font-semibold hidden">‚ö†Ô∏è Paste: <span id="t2_intro_pastes">0</span> l·∫ßn</span>
                        </div>
                        <div id="t2_intro_count" class="text-lg font-semibold text-gray-700">Words: 0 / 50-70</div>
                    </div>
                </div>
            </div>
        </div>
<!-- TOPIC 3 -->
        <div class="bg-white rounded-2xl shadow-2xl p-8 mb-6 fade-in">
            <div class="bg-gradient-to-r from-teal-600 to-teal-500 text-white px-6 py-4 rounded-t-xl -mx-8 -mt-8 mb-6">
                <h2 class="text-2xl font-bold">üìù TOPIC 3: TECHNOLOGY & HAPPINESS</h2>
                <p class="text-sm opacity-90">Technology has made our lives easier but has it made us happier?</p>
            </div>

            <!-- Full prompt -->
            <div class="bg-teal-50 border-l-4 border-teal-600 p-5 mb-6 rounded-r-lg">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <h3 class="font-bold text-teal-800 mb-3 text-lg">üìã Essay Topic:</h3>
                        <p class="text-teal-900 mb-3 text-lg font-semibold">"Technology has made our lives easier but has it made us happier? Do you agree?"</p>
                        <p class="text-teal-700 text-sm"><em>Points to consider: social media impact / work-life balance / your own idea</em></p>
                    </div>
                    <button onclick="togglePrompt('topic3')" class="ml-4 text-teal-600 hover:text-teal-800 font-semibold text-sm whitespace-nowrap">
                        [Show more ‚ñº]
                    </button>
                </div>
                
                <div id="topic3Prompt" class="topic-prompt mt-4 pt-4 border-t border-teal-200">
                    <p class="text-teal-800 text-sm leading-relaxed">
                        Modern technology has transformed how we live, work, and communicate. While smartphones, computers, and the internet have made many tasks more convenient, questions remain about their impact on our overall happiness and well-being. Consider the effects of social media, changes in work-life balance, and other technological impacts on human happiness.
                    </p>
                </div>
            </div>

            <!-- Essay Analysis -->
            <div class="bg-gray-50 rounded-xl p-6 mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b-2 border-green-500 pb-2">PART 1: ESSAY ANALYSIS</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">1. SS (Specific Subject): *</label>
                        <input type="text" id="t3_ss" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg"
                            placeholder="Are there any specific subjects?"
                            data-field="t3_ss">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">2. IS (Independent Subject): *</label>
                        <input type="text" id="t3_is" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg"
                            placeholder="Are there any independent subjects?"
                            data-field="t3_is">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">3. Q (Question): *</label>
                        <input type="text" id="t3_q" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg"
                            placeholder="What are the questions?"
                            data-field="t3_q">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">4. T (Task): *</label>
                        <input type="text" id="t3_t" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg"
                            placeholder="How many tasks must we address?"
                            data-field="t3_t">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Body 1: *</label>
                            <input type="text" id="t3_body1" 
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                placeholder="Idea 1"
                                data-field="t3_body1">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Body 2: *</label>
                            <input type="text" id="t3_body2" 
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                placeholder="Idea 2"
                                data-field="t3_body2">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Body 3: *</label>
                            <input type="text" id="t3_body3" 
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                placeholder="Your own idea"
                                data-field="t3_body3">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Write Introduction -->
            <div class="bg-gray-50 rounded-xl p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b-2 border-green-500 pb-2">PART 2: WRITE INTRODUCTION</h3>
                
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Introduction Paragraph: *</label>
                    <textarea id="t3_intro" rows="8"
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg resize-vertical"
                        placeholder="Write your introduction here... (50-70 words recommended)"
                        data-field="t3_intro"></textarea>
                    <div class="flex justify-between items-center mt-2">
                        <div class="text-sm text-gray-600">
                            <span>‚úèÔ∏è Edits: <span id="t3_intro_edits" class="font-semibold">0</span></span>
                            <span class="mx-2">|</span>
                            <span id="t3_intro_paste_warning" class="text-red-600 font-semibold hidden">‚ö†Ô∏è Paste: <span id="t3_intro_pastes">0</span></span>
                        </div>
                        <div id="t3_intro_count" class="text-lg font-semibold text-gray-700">Words: 0 / 50-70</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TOPIC 4 -->
        <div class="bg-white rounded-2xl shadow-2xl p-8 mb-6 fade-in">
            <div class="bg-gradient-to-r from-orange-600 to-orange-500 text-white px-6 py-4 rounded-t-xl -mx-8 -mt-8 mb-6">
                <h2 class="text-2xl font-bold">üìù TOPIC 4: OPPORTUNITIES FOR YOUNG PEOPLE</h2>
                <p class="text-sm opacity-90">Young people today have more opportunities than their parents' generation</p>
            </div>

            <!-- Full prompt -->
            <div class="bg-orange-50 border-l-4 border-orange-600 p-5 mb-6 rounded-r-lg">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <h3 class="font-bold text-orange-800 mb-3 text-lg">üìã Essay Topic:</h3>
                        <p class="text-orange-900 mb-3 text-lg font-semibold">"Young people today have more opportunities than their parents' generation. Do you agree?"</p>
                        <p class="text-orange-700 text-sm"><em>Points to consider: education access / career choices / your own idea</em></p>
                    </div>
                    <button onclick="togglePrompt('topic4')" class="ml-4 text-orange-600 hover:text-orange-800 font-semibold text-sm whitespace-nowrap">
                        [Show more ‚ñº]
                    </button>
                </div>
                
                <div id="topic4Prompt" class="topic-prompt mt-4 pt-4 border-t border-orange-200">
                    <p class="text-orange-800 text-sm leading-relaxed">
                        Many argue that young people today have access to more opportunities than previous generations, particularly in education and career paths. With the internet, global connectivity, and diverse educational options, young people can pursue dreams that weren't available to their parents. However, some point to new challenges like increased competition and economic pressures.
                    </p>
                </div>
            </div>

            <!-- Essay Analysis -->
            <div class="bg-gray-50 rounded-xl p-6 mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b-2 border-green-500 pb-2">PART 1: ESSAY ANALYSIS</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">1. SS (Specific Subject): *</label>
                        <input type="text" id="t4_ss" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg"
                            placeholder="Are there any specific subjects?"
                            data-field="t4_ss">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">2. IS (Independent Subject): *</label>
                        <input type="text" id="t4_is" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg"
                            placeholder="Are there any independent subjects?"
                            data-field="t4_is">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">3. Q (Question): *</label>
                        <input type="text" id="t4_q" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg"
                            placeholder="What are the questions?"
                            data-field="t4_q">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">4. T (Task): *</label>
                        <input type="text" id="t4_t" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg"
                            placeholder="How many tasks must we address?"
                            data-field="t4_t">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Body 1: *</label>
                            <input type="text" id="t4_body1" 
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                placeholder="Idea 1"
                                data-field="t4_body1">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Body 2: *</label>
                            <input type="text" id="t4_body2" 
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                placeholder="Idea 2"
                                data-field="t4_body2">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Body 3: *</label>
                            <input type="text" id="t4_body3" 
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                placeholder="Your own idea"
                                data-field="t4_body3">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Write Introduction -->
            <div class="bg-gray-50 rounded-xl p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b-2 border-green-500 pb-2">PART 2: WRITE INTRODUCTION</h3>
                
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Introduction Paragraph: *</label>
                    <textarea id="t4_intro" rows="8"
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg resize-vertical"
                        placeholder="Write your introduction here... (50-70 words recommended)"
                        data-field="t4_intro"></textarea>
                    <div class="flex justify-between items-center mt-2">
                        <div class="text-sm text-gray-600">
                            <span>‚úèÔ∏è Edits: <span id="t4_intro_edits" class="font-semibold">0</span></span>
                            <span class="mx-2">|</span>
                            <span id="t4_intro_paste_warning" class="text-red-600 font-semibold hidden">‚ö†Ô∏è Paste: <span id="t4_intro_pastes">0</span></span>
                        </div>
                        <div id="t4_intro_count" class="text-lg font-semibold text-gray-700">Words: 0 / 50-70</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TOPIC 5 -->
        <div class="bg-white rounded-2xl shadow-2xl p-8 mb-6 fade-in">
            <div class="bg-gradient-to-r from-pink-600 to-pink-500 text-white px-6 py-4 rounded-t-xl -mx-8 -mt-8 mb-6">
                <h2 class="text-2xl font-bold">üìù TOPIC 5: PRACTICAL LIFE SKILLS IN SCHOOLS</h2>
                <p class="text-sm opacity-90">Schools should teach practical life skills rather than just academic subjects</p>
            </div>

            <!-- Full prompt -->
            <div class="bg-pink-50 border-l-4 border-pink-600 p-5 mb-6 rounded-r-lg">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <h3 class="font-bold text-pink-800 mb-3 text-lg">üìã Essay Topic:</h3>
                        <p class="text-pink-900 mb-3 text-lg font-semibold">"Schools should teach practical life skills rather than just academic subjects. Do you agree?"</p>
                        <p class="text-pink-700 text-sm"><em>Points to consider: financial management / communication skills / your own idea</em></p>
                    </div>
                    <button onclick="togglePrompt('topic5')" class="ml-4 text-pink-600 hover:text-pink-800 font-semibold text-sm whitespace-nowrap">
                        [Show more ‚ñº]
                    </button>
                </div>
                
                <div id="topic5Prompt" class="topic-prompt mt-4 pt-4 border-t border-pink-200">
                    <p class="text-pink-800 text-sm leading-relaxed">
                        There is growing debate about whether schools should place more emphasis on teaching practical life skills alongside traditional academic subjects. Supporters argue that skills like financial literacy, effective communication, and problem-solving are essential for success in adult life, while others believe academic knowledge remains the foundation of education.
                    </p>
                </div>
            </div>

            <!-- Essay Analysis -->
            <div class="bg-gray-50 rounded-xl p-6 mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b-2 border-green-500 pb-2">PART 1: ESSAY ANALYSIS</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">1. SS (Specific Subject): *</label>
                        <input type="text" id="t5_ss" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg"
                            placeholder="Are there any specific subjects?"
                            data-field="t5_ss">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">2. IS (Independent Subject): *</label>
                        <input type="text" id="t5_is" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg"
                            placeholder="Are there any independent subjects?"
                            data-field="t5_is">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">3. Q (Question): *</label>
                        <input type="text" id="t5_q" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg"
                            placeholder="What are the questions?"
                            data-field="t5_q">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">4. T (Task): *</label>
                        <input type="text" id="t5_t" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg"
                            placeholder="How many tasks must we address?"
                            data-field="t5_t">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Body 1: *</label>
                            <input type="text" id="t5_body1" 
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                placeholder="Idea 1"
                                data-field="t5_body1">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Body 2: *</label>
                            <input type="text" id="t5_body2" 
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                placeholder="Idea 2"
                                data-field="t5_body2">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Body 3: *</label>
                            <input type="text" id="t5_body3" 
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                placeholder="Your own idea"
                                data-field="t5_body3">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Write Introduction -->
            <div class="bg-gray-50 rounded-xl p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b-2 border-green-500 pb-2">PART 2: WRITE INTRODUCTION</h3>
                
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Introduction Paragraph: *</label>
                    <textarea id="t5_intro" rows="8"
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg resize-vertical"
                        placeholder="Write your introduction here... (50-70 words recommended)"
                        data-field="t5_intro"></textarea>
                    <div class="flex justify-between items-center mt-2">
                        <div class="text-sm text-gray-600">
                            <span>‚úèÔ∏è Edits: <span id="t5_intro_edits" class="font-semibold">0</span></span>
                            <span class="mx-2">|</span>
                            <span id="t5_intro_paste_warning" class="text-red-600 font-semibold hidden">‚ö†Ô∏è Paste: <span id="t5_intro_pastes">0</span></span>
                        </div>
                        <div id="t5_intro_count" class="text-lg font-semibold text-gray-700">Words: 0 / 50-70</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Submit Button -->
        <div class="bg-white rounded-2xl shadow-2xl p-8">
            <div id="warningBox" class="hidden mb-4 p-4 bg-yellow-50 border-2 border-yellow-300 rounded-lg">
                <p class="text-yellow-800">
                    ‚ö†Ô∏è B·∫°n c√≤n <span id="missingCount" class="font-bold">16</span> m·ª•c ch∆∞a ƒëi·ªÅn!
                </p>
            </div>
            
            <button onclick="submitTest()" id="submitBtn"
                class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-lg transition text-xl shadow-lg">
                üöÄ N·ªòP B√ÄI
            </button>
        </div>
    </div>
</div>

<!-- M√†n h√¨nh k·∫øt qu·∫£ -->
<div id="resultScreen" class="hidden min-h-screen p-4">
    <div class="max-w-5xl mx-auto">
        <div class="bg-white rounded-2xl shadow-2xl p-8 mt-8 fade-in">
            <div class="text-center mb-6">
                <img src="https://gofirst.pro/images/uploads/62/baseimg/logo_16541442053.png" 
                     alt="LIME Logo" class="w-32 h-32 mx-auto mb-4 object-contain">
                <h1 class="text-3xl font-bold text-green-700 mb-2">Trung T√¢m Ti·∫øng Anh LIME</h1>
                <p class="text-green-600">üìû Hotline: 0976222792</p>
            </div>

            <div class="text-center mb-8">
                <svg class="w-24 h-24 text-green-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <h2 class="text-3xl font-bold text-green-800 mb-4">N·ªôp b√†i th√†nh c√¥ng!</h2>
                <p class="text-gray-600 text-lg">Gi√°o vi√™n s·∫Ω ch·∫•m v√† ph·∫£n h·ªìi s·ªõm nh·∫•t</p>
            </div>

            <!-- Th·ªëng k√™ -->
            <div class="bg-green-50 rounded-xl p-6 mb-6 border-2 border-green-200">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div>
                        <p class="text-gray-600">Ho√†n th√†nh</p>
                        <p id="resultCompletion" class="text-3xl font-bold text-green-700">0%</p>
                    </div>
                    <div>
                        <p class="text-gray-600">Th·ªùi gian</p>
                        <p id="resultTime" class="text-2xl font-bold text-green-700">0 ph√∫t</p>
                    </div>
                    <div>
                        <p class="text-gray-600">T·ªïng t·ª´</p>
                        <p id="resultWords" class="text-2xl font-bold text-blue-700">0</p>
                    </div>
                    <div>
                        <p class="text-gray-600">Paste</p>
                        <p id="resultPaste" class="text-2xl font-bold text-orange-700">0 l·∫ßn</p>
                    </div>
                </div>
            </div>

            <!-- H√†nh vi l√†m b√†i -->
            <div class="bg-blue-50 rounded-xl p-6 mb-6 border-2 border-blue-200">
                <h3 class="font-bold text-blue-800 mb-4 text-xl">üìä Th·ªëng k√™ h√†nh vi l√†m b√†i</h3>
                <div id="behaviorStats" class="space-y-3 text-blue-900"></div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <button onclick="location.reload()" 
                    class="bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-lg transition shadow-lg">
                    ‚Üê V·ªÅ trang ch·ªß
                </button>
                <button onclick="location.reload()" 
                    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-lg transition shadow-lg">
                    L√†m b√†i ti·∫øp ‚Üí
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// ========== CONFIGURATION ==========
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzIp9jfs0GEOh_Y-0AnBBXXaX4AjsMHHW7SkZjDjJwtXFHicIqXyddq9IOZmEijXuu-Fg/exec';
const WEEK_NUMBER = 1;

// ========== GLOBAL VARIABLES ==========
let studentInfo = {};
let startTime;
let timerInterval;
let elapsedSeconds = 0;

// Behavior tracking
let behaviorData = {
    // Topic 1
    t1_ss: { edits: 0, pastes: 0, time: 0 },
    t1_is: { edits: 0, pastes: 0, time: 0 },
    t1_q: { edits: 0, pastes: 0, time: 0 },
    t1_t: { edits: 0, pastes: 0, time: 0 },
    t1_body1: { edits: 0, pastes: 0, time: 0 },
    t1_body2: { edits: 0, pastes: 0, time: 0 },
    t1_body3: { edits: 0, pastes: 0, time: 0 },
    t1_intro: { edits: 0, pastes: 0, time: 0 },
    // Topic 2
    t2_ss: { edits: 0, pastes: 0, time: 0 },
    t2_is: { edits: 0, pastes: 0, time: 0 },
    t2_q: { edits: 0, pastes: 0, time: 0 },
    t2_t: { edits: 0, pastes: 0, time: 0 },
    t2_body1: { edits: 0, pastes: 0, time: 0 },
    t2_body2: { edits: 0, pastes: 0, time: 0 },
    t2_body3: { edits: 0, pastes: 0, time: 0 },
    t2_intro: { edits: 0, pastes: 0, time: 0 },
    // Topic 3
    t3_ss: { edits: 0, pastes: 0, time: 0 },
    t3_is: { edits: 0, pastes: 0, time: 0 },
    t3_q: { edits: 0, pastes: 0, time: 0 },
    t3_t: { edits: 0, pastes: 0, time: 0 },
    t3_body1: { edits: 0, pastes: 0, time: 0 },
    t3_body2: { edits: 0, pastes: 0, time: 0 },
    t3_body3: { edits: 0, pastes: 0, time: 0 },
    t3_intro: { edits: 0, pastes: 0, time: 0 },
    // Topic 4
    t4_ss: { edits: 0, pastes: 0, time: 0 },
    t4_is: { edits: 0, pastes: 0, time: 0 },
    t4_q: { edits: 0, pastes: 0, time: 0 },
    t4_t: { edits: 0, pastes: 0, time: 0 },
    t4_body1: { edits: 0, pastes: 0, time: 0 },
    t4_body2: { edits: 0, pastes: 0, time: 0 },
    t4_body3: { edits: 0, pastes: 0, time: 0 },
    t4_intro: { edits: 0, pastes: 0, time: 0 },
    // Topic 5
    t5_ss: { edits: 0, pastes: 0, time: 0 },
    t5_is: { edits: 0, pastes: 0, time: 0 },
    t5_q: { edits: 0, pastes: 0, time: 0 },
    t5_t: { edits: 0, pastes: 0, time: 0 },
    t5_body1: { edits: 0, pastes: 0, time: 0 },
    t5_body2: { edits: 0, pastes: 0, time: 0 },
    t5_body3: { edits: 0, pastes: 0, time: 0 },
    t5_intro: { edits: 0, pastes: 0, time: 0 }
};
let fieldTimers = {};

// ========== TOGGLE PROMPT ==========
function togglePrompt(topicId) {
    const prompt = document.getElementById(topicId + 'Prompt');
    prompt.classList.toggle('expanded');
}

// ========== STUDENT VERIFICATION ==========
async function verifyStudent() {
    const code = document.getElementById('studentCode').value.trim().toUpperCase();
    if (!code) {
        alert('Vui l√≤ng nh·∫≠p m√£ h·ªçc sinh!');
        return;
    }
    
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.disabled = true;
    btn.innerHTML = '<div class="spinner"></div> <span>ƒêang x√°c nh·∫≠n...</span>';
    
    try {
        const response = await fetch(`${GOOGLE_SCRIPT_URL}?action=verify&code=${code}`);
        const data = await response.json();
        
        if (data.exists) {
            studentInfo = { code: code, name: data.studentName };
            document.getElementById('codeScreen').classList.add('hidden');
            document.getElementById('testScreen').classList.remove('hidden');
            document.getElementById('headerName').textContent = data.studentName;
            document.getElementById('headerCode').textContent = code;
            
            initializeTracking();
            startTime = new Date();
            startTimer();
        } else {
            btn.disabled = false;
            btn.innerHTML = originalText;
            alert('‚ùå M√£ h·ªçc sinh kh√¥ng t·ªìn t·∫°i!\n\nüìû Vui l√≤ng li√™n h·ªá gi√°o vi√™n ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£.');
        }
    } catch (error) {
        btn.disabled = false;
        btn.innerHTML = originalText;
        alert('‚ö†Ô∏è L·ªói k·∫øt n·ªëi! Vui l√≤ng ki·ªÉm tra Internet ho·∫∑c li√™n h·ªá gi√°o vi√™n.');
        console.error('Error:', error);
    }
}

// ========== TIMER ==========
function startTimer() {
    timerInterval = setInterval(() => {
        elapsedSeconds++;
        updateTimerDisplay();
    }, 1000);
}

function updateTimerDisplay() {
    const minutes = Math.floor(elapsedSeconds / 60);
    const seconds = elapsedSeconds % 60;
    const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    document.getElementById('timerDisplay').textContent = display;
}

function stopTimer() {
    if (timerInterval) {
        clearInterval(timerInterval);
    }
}

// ========== BEHAVIOR TRACKING ==========
function initializeTracking() {
    const fields = document.querySelectorAll('[data-field]');
    
    fields.forEach(field => {
        const fieldId = field.id;
        let lastValue = '';
        let typingTimer;
        
        // Focus event - start timer
        field.addEventListener('focus', () => {
            fieldTimers[fieldId] = Date.now();
        });
        
        // Blur event - calculate time spent
        field.addEventListener('blur', () => {
            if (fieldTimers[fieldId]) {
                const timeSpent = Date.now() - fieldTimers[fieldId];
                behaviorData[fieldId].time += timeSpent;
                delete fieldTimers[fieldId];
            }
        });
        
        // Paste detection
        field.addEventListener('paste', (e) => {
            behaviorData[fieldId].pastes++;
            
            // Visual warning
            field.classList.add('paste-warning');
            setTimeout(() => {
                field.classList.remove('paste-warning');
            }, 500);
            
            // Update paste counter for textareas
            if (field.tagName === 'TEXTAREA') {
                const pasteSpan = document.getElementById(`${fieldId}_pastes`);
                const pasteWarning = document.getElementById(`${fieldId}_paste_warning`);
                if (pasteSpan && pasteWarning) {
                    pasteSpan.textContent = behaviorData[fieldId].pastes;
                    pasteWarning.classList.remove('hidden');
                }
            }
            
            console.log(`Paste detected in ${fieldId}: ${behaviorData[fieldId].pastes} times`);
        });
        
        // Edit tracking
        field.addEventListener('input', () => {
            clearTimeout(typingTimer);
            
            typingTimer = setTimeout(() => {
                const currentValue = field.value;
                
                // Count as edit if significant change (more than 3 chars difference)
                if (lastValue && Math.abs(currentValue.length - lastValue.length) > 3) {
                    behaviorData[fieldId].edits++;
                    
                    // Update edit counter for textareas
                    if (field.tagName === 'TEXTAREA') {
                        const editSpan = document.getElementById(`${fieldId}_edits`);
                        if (editSpan) {
                            editSpan.textContent = behaviorData[fieldId].edits;
                        }
                    }
                }
                
                lastValue = currentValue;
                
                // Update word count for textareas
                if (field.tagName === 'TEXTAREA') {
                    updateWordCount(fieldId);
                }
                
                updateProgress();
            }, 500);
        });
    });
}

// ========== WORD COUNT ==========
function updateWordCount(fieldId) {
    const textarea = document.getElementById(fieldId);
    const countDiv = document.getElementById(`${fieldId}_count`);
    
    if (!textarea || !countDiv) return;
    
    const text = textarea.value.trim();
    const words = text.length > 0 ? text.split(/\s+/).filter(w => w.length > 0).length : 0;
    
    countDiv.textContent = `Words: ${words} / 50-70`;
    
    // Color coding
    if (words >= 50 && words <= 70) {
        countDiv.className = 'text-lg font-semibold text-green-600';
    } else if (words > 40 && words < 80) {
        countDiv.className = 'text-lg font-semibold text-yellow-600';
    } else if (words > 0) {
        countDiv.className = 'text-lg font-semibold text-red-600';
    } else {
        countDiv.className = 'text-lg font-semibold text-gray-700';
    }
}

// ========== PROGRESS TRACKING ==========
function updateProgress() {
    let filledCount = 0;
    const requiredFields = [
        't1_ss', 't1_is', 't1_q', 't1_t', 't1_body1', 't1_body2', 't1_intro',
        't2_ss', 't2_is', 't2_q', 't2_t', 't2_body1', 't2_body2', 't2_intro',
        't3_ss', 't3_is', 't3_q', 't3_t', 't3_body1', 't3_body2', 't3_intro',
        't4_ss', 't4_is', 't4_q', 't4_t', 't4_body1', 't4_body2', 't4_intro',
        't5_ss', 't5_is', 't5_q', 't5_t', 't5_body1', 't5_body2', 't5_intro'
    ];
    
    requiredFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field && field.value.trim().length > 0) {
            filledCount++;
        }
    });
    
    // Count optional fields separately
    const optionalFields = ['t1_body3', 't2_body3', 't3_body3', 't4_body3', 't5_body3'];
    optionalFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field && field.value.trim().length > 0) {
            filledCount++;
        }
    });
    
    const totalFields = requiredFields.length + optionalFields.length;
    const percent = Math.round((filledCount / totalFields) * 100);
    
    document.getElementById('progressCount').textContent = filledCount;
    document.getElementById('progressPercent').textContent = percent + '%';
    document.getElementById('progressBar').style.width = percent + '%';
    
    const missing = totalFields - filledCount;
    if (missing > 0) {
        document.getElementById('warningBox').classList.remove('hidden');
        document.getElementById('missingCount').textContent = missing;
    } else {
        document.getElementById('warningBox').classList.add('hidden');
    }
}
// ========== SUBMIT TEST ==========
async function submitTest() {
    // Check completion
    const requiredFields = [
        't1_ss', 't1_is', 't1_q', 't1_t', 't1_body1', 't1_body2', 't1_intro',
        't2_ss', 't2_is', 't2_q', 't2_t', 't2_body1', 't2_body2', 't2_intro',
        't3_ss', 't3_is', 't3_q', 't3_t', 't3_body1', 't3_body2', 't3_intro',
        't4_ss', 't4_is', 't4_q', 't4_t', 't4_body1', 't4_body2', 't4_intro',
        't5_ss', 't5_is', 't5_q', 't5_t', 't5_body1', 't5_body2', 't5_intro'
    ];
    
    let missingCount = 0;
    requiredFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (!field || field.value.trim().length === 0) {
            missingCount++;
        }
    });
    
    if (missingCount > 0) {
        if (!confirm(`You still have ${missingCount} required fields empty. Submit anyway?`)) return;
    }
    
    stopTimer();
    
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<div class="spinner"></div> <span>Processing...</span>';
    
    // Collect all data
    const answers = {};
    const allFields = Object.keys(behaviorData);
    
    allFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
            answers[fieldId] = field.value.trim();
        }
    });
    
    // Calculate word counts
    const t1IntroWords = answers.t1_intro ? answers.t1_intro.split(/\s+/).filter(w => w.length > 0).length : 0;
    const t2IntroWords = answers.t2_intro ? answers.t2_intro.split(/\s+/).filter(w => w.length > 0).length : 0;
    const t3IntroWords = answers.t3_intro ? answers.t3_intro.split(/\s+/).filter(w => w.length > 0).length : 0;
    const t4IntroWords = answers.t4_intro ? answers.t4_intro.split(/\s+/).filter(w => w.length > 0).length : 0;
    const t5IntroWords = answers.t5_intro ? answers.t5_intro.split(/\s+/).filter(w => w.length > 0).length : 0;
    const totalWords = t1IntroWords + t2IntroWords + t3IntroWords + t4IntroWords + t5IntroWords;
    
    const totalPastes = Object.values(behaviorData).reduce((sum, data) => sum + data.pastes, 0);
    const totalEdits = Object.values(behaviorData).reduce((sum, data) => sum + data.edits, 0);
    
    // Calculate time spent per field (in seconds)
    const timeBreakdown = {};
    Object.keys(behaviorData).forEach(fieldId => {
        timeBreakdown[fieldId] = Math.round(behaviorData[fieldId].time / 1000);
    });
    
    const timeUsedMinutes = Math.floor(elapsedSeconds / 60);
    const timeUsedSeconds = elapsedSeconds % 60;
    const timeUsedDisplay = `${timeUsedMinutes}m ${timeUsedSeconds}s`;
    
    const completionPercent = Math.round((requiredFields.filter(f => {
        const field = document.getElementById(f);
        return field && field.value.trim().length > 0;
    }).length / requiredFields.length) * 100);
    
    // Helper function to calculate time for a topic
    function calcTopicTime(prefix) {
        return Math.round((
            behaviorData[`${prefix}_ss`].time +
            behaviorData[`${prefix}_is`].time +
            behaviorData[`${prefix}_q`].time +
            behaviorData[`${prefix}_t`].time +
            behaviorData[`${prefix}_body1`].time +
            behaviorData[`${prefix}_body2`].time +
            behaviorData[`${prefix}_body3`].time +
            behaviorData[`${prefix}_intro`].time
        ) / 1000);
    }
    
    // Data to send
    const dataToSend = {
        studentCode: studentInfo.code,
        studentName: studentInfo.name,
        weekNumber: WEEK_NUMBER,
        examType: 'essay',
        totalTimeSeconds: elapsedSeconds,

        // === TOPIC 1 ===
        topic1: {
            ss: answers.t1_ss || '',
            is: answers.t1_is || '',
            q: answers.t1_q || '',
            t: answers.t1_t || '',
            body1: answers.t1_body1 || '',
            body2: answers.t1_body2 || '',
            body3: answers.t1_body3 || '',
            introduction: answers.t1_intro || '',
            wordCount: t1IntroWords,
            timeSeconds: calcTopicTime('t1'),
            keystrokeLog: {
        pastes: behaviorData.t1_intro.pastes,
        edits: behaviorData.t1_intro.edits
    }
        },

        // === TOPIC 2 ===
        topic2: {
            ss: answers.t2_ss || '',
            is: answers.t2_is || '',
            q: answers.t2_q || '',
            t: answers.t2_t || '',
            body1: answers.t2_body1 || '',
            body2: answers.t2_body2 || '',
            body3: answers.t2_body3 || '',
            introduction: answers.t2_intro || '',
            wordCount: t2IntroWords,
            timeSeconds: calcTopicTime('t2'),
            keystrokeLog: {
        pastes: behaviorData.t2_intro.pastes,
        edits: behaviorData.t2_intro.edits
    }
        },

        // === TOPIC 3 ===
        topic3: {
            ss: answers.t3_ss || '',
            is: answers.t3_is || '',
            q: answers.t3_q || '',
            t: answers.t3_t || '',
            body1: answers.t3_body1 || '',
            body2: answers.t3_body2 || '',
            body3: answers.t3_body3 || '',
            introduction: answers.t3_intro || '',
            wordCount: t3IntroWords,
            timeSeconds: calcTopicTime('t3'),
            keystrokeLog: {
        pastes: behaviorData.t3_intro.pastes,
        edits: behaviorData.t3_intro.edits
    }
        },

        // === TOPIC 4 ===
        topic4: {
            ss: answers.t4_ss || '',
            is: answers.t4_is || '',
            q: answers.t4_q || '',
            t: answers.t4_t || '',
            body1: answers.t4_body1 || '',
            body2: answers.t4_body2 || '',
            body3: answers.t4_body3 || '',
            introduction: answers.t4_intro || '',
            wordCount: t4IntroWords,
            timeSeconds: calcTopicTime('t4'),
            keystrokeLog: {
        pastes: behaviorData.t4_intro.pastes,
        edits: behaviorData.t4_intro.edits
    }
        },

        // === TOPIC 5 ===
        topic5: {
            ss: answers.t5_ss || '',
            is: answers.t5_is || '',
            q: answers.t5_q || '',
            t: answers.t5_t || '',
            body1: answers.t5_body1 || '',
            body2: answers.t5_body2 || '',
            body3: answers.t5_body3 || '',
            introduction: answers.t5_intro || '',
            wordCount: t5IntroWords,
            timeSeconds: calcTopicTime('t5'),
            keystrokeLog: {
        pastes: behaviorData.t5_intro.pastes,
        edits: behaviorData.t5_intro.edits
    }
        },

        // === STATISTICS & BEHAVIOR ===
        totalPastes: totalPastes,
        totalEdits: totalEdits,
        behaviorData: behaviorData,
        timeBreakdown: timeBreakdown,

        // === DETAILED LOGS ===
        detailedLogs: {
            t1_intro_edits: behaviorData.t1_intro.edits,
            t1_intro_pastes: behaviorData.t1_intro.pastes,
            t2_intro_edits: behaviorData.t2_intro.edits,
            t2_intro_pastes: behaviorData.t2_intro.pastes,
            t3_intro_edits: behaviorData.t3_intro.edits,
            t3_intro_pastes: behaviorData.t3_intro.pastes,
            t4_intro_edits: behaviorData.t4_intro.edits,
            t4_intro_pastes: behaviorData.t4_intro.pastes,
            t5_intro_edits: behaviorData.t5_intro.edits,
            t5_intro_pastes: behaviorData.t5_intro.pastes
        }
    };
    
    try {
        await fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(dataToSend)
        });
        
        console.log('Data sent:', dataToSend);
        showResults(completionPercent, timeUsedDisplay, totalWords, totalPastes, totalEdits);
        
    } catch (error) {
        console.error('Error sending data:', error);
        showResults(completionPercent, timeUsedDisplay, totalWords, totalPastes, totalEdits);
    }
}
// ========== SHOW RESULTS ==========
function showResults(completionPercent, timeUsed, totalWords, totalPastes, totalEdits) {
    document.getElementById('testScreen').classList.add('hidden');
    document.getElementById('resultScreen').classList.remove('hidden');
    
    document.getElementById('resultCompletion').textContent = completionPercent + '%';
    document.getElementById('resultTime').textContent = timeUsed;
    document.getElementById('resultWords').textContent = totalWords;
    document.getElementById('resultPaste').textContent = totalPastes;
    
    // Behavior stats
    let behaviorHtml = '';
    
    behaviorHtml += `<div class="flex items-center gap-2">
        <span class="text-2xl">‚úèÔ∏è</span>
        <span>Total edits: <strong>${totalEdits}</strong></span>
    </div>`;
    
    behaviorHtml += `<div class="flex items-center gap-2">
        <span class="text-2xl">üìã</span>
        <span>Total pastes: <strong>${totalPastes}</strong> ${totalPastes > 5 ? '‚ö†Ô∏è (Many)' : totalPastes > 0 ? '(Normal)' : '‚úÖ (Good)'}</span>
    </div>`;
    
    // Per-topic stats
    for (let i = 1; i <= 5; i++) {
        const prefix = `t${i}`;
        const words = document.getElementById(`${prefix}_intro`).value.trim().split(/\s+/).filter(w => w.length > 0).length;
        const time = Math.round((
            behaviorData[`${prefix}_ss`].time +
            behaviorData[`${prefix}_is`].time +
            behaviorData[`${prefix}_q`].time +
            behaviorData[`${prefix}_t`].time +
            behaviorData[`${prefix}_body1`].time +
            behaviorData[`${prefix}_body2`].time +
            behaviorData[`${prefix}_body3`].time +
            behaviorData[`${prefix}_intro`].time
        ) / 1000);
        
        behaviorHtml += `<div class="flex items-center gap-2">
            <span class="text-2xl">üìù</span>
            <span>Topic ${i}: <strong>${words} words</strong> | 
            ${behaviorData[`${prefix}_intro`].edits} edits | 
            ${behaviorData[`${prefix}_intro`].pastes} pastes | 
            ${Math.floor(time / 60)}m ${time % 60}s</span>
        </div>`;
    }
    
    document.getElementById('behaviorStats').innerHTML = behaviorHtml;
}

// ========== AUTO-SAVE ==========
setInterval(() => {
    if (studentInfo.code) {
        const allFields = Object.keys(behaviorData);
        const autoSaveData = {};
        
        allFields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field) {
                autoSaveData[fieldId] = field.value;
            }
        });
        
        localStorage.setItem(`week1_${studentInfo.code}`, JSON.stringify(autoSaveData));
        console.log('Auto-saved at', new Date().toLocaleTimeString());
    }
}, 30000); // Auto-save every 30 seconds

</script>

</body>
</html>